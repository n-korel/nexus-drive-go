# NEXUS DRIVE GO

–ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –∑–∞–∫–∞–∑–∞ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —É—Å–ª—É–≥ —Ç–∞–∫—Å–∏, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –Ω–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ. –°–∏—Å—Ç–µ–º–∞ –≤–∫–ª—é—á–∞–µ—Ç –±—ç–∫–µ–Ω–¥ –Ω–∞ Go –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –Ω–∞ Next.js v15.

## üèóÔ∏è –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É** —Å —Å–æ–±—ã—Ç–∏–π–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ–º:

### –°–µ—Ä–≤–∏—Å—ã –Ω–∞ Go

- **API Gateway** - HTTP/WebSocket —à–ª—é–∑ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤, –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã
- **Trip Service** - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–µ–∑–¥–∫–∞–º–∏, –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤, —Ä–∞—Å—á–µ—Ç —Ç–∞—Ä–∏—Ñ–æ–≤
- **Driver Service** - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–æ–¥–∏—Ç–µ–ª—è–º–∏, –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è
- **Payment Service** - –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π —á–µ—Ä–µ–∑ Stripe

### –§—Ä–æ–Ω—Ç–µ–Ω–¥

- **Web Frontend** - Next.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ React —Å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π –∫–∞—Ä—Ç–æ–π (Leaflet)

### –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

- **RabbitMQ** - Message broker –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤
- **MongoDB** - –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–µ–∑–¥–æ–∫ –∏ —Ç–∞—Ä–∏—Ñ–æ–≤
- **Jaeger** - –†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∞–Ω–∏–µ
- **Kubernetes** - –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (local k8s –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

## üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç—ã

<div align="center">

### –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞

<img src="docs/images/home.jpg" alt="–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞" width="700"/>

_–í—ã–±–æ—Ä —Ä–æ–ª–∏: –ø–∞—Å—Å–∞–∂–∏—Ä –∏–ª–∏ –≤–æ–¥–∏—Ç–µ–ª—å_

---

### –ö–∞—Ä—Ç–∞ –ø–∞—Å—Å–∞–∂–∏—Ä–∞

<img src="docs/images/rider-map.jpg" alt="–ö–∞—Ä—Ç–∞ –ø–∞—Å—Å–∞–∂–∏—Ä–∞" width="700"/>

_–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞ —Å –≤—ã–±–æ—Ä–æ–º –º–∞—Ä—à—Ä—É—Ç–∞ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤–æ–¥–∏—Ç–µ–ª–µ–π_

---

### –í—ã–±–æ—Ä —Ç–∏–ø–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª—è

<img src="docs/images/driver-selection.jpg" alt="–í—ã–±–æ—Ä —Ç–∏–ø–∞ –ø–æ–µ–∑–¥–∫–∏" width="700"/>

_–í—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª—è —Å —Ä–∞—Å—á—ë—Ç–æ–º —Ç–∞—Ä–∏—Ñ–∞_

---

### –ö–∞—Ä—Ç–∞ –≤–æ–¥–∏—Ç–µ–ª—è

<img src="docs/images/driver-map.jpg" alt="–ö–∞—Ä—Ç–∞ –≤–æ–¥–∏—Ç–µ–ª—è" width="700"/>

_–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤–æ–¥–∏—Ç–µ–ª—è —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∑–∞–∫–∞–∑–µ_

---

### –û–ø–ª–∞—Ç–∞ –ø–æ–µ–∑–¥–∫–∏

<img src="docs/images/payment.jpg" alt="–û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ Stripe" width="700"/>

_–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å–æ Stripe –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –æ–ø–ª–∞—Ç—ã_

</div>

## üìä –î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

–í–æ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞, –∏–ª–ª—é—Å—Ç—Ä–∏—Ä—É—é—â–∞—è –ø—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–µ–∑–¥–∫–∏ –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤:

```mermaid
sequenceDiagram
  participant User as User
  participant APIGateway as APIGateway
  participant TripService as TripService
  participant DriverService as DriverService
  participant Driver as Driver
  participant PaymentService as PaymentService
  participant Stripe as Stripe API
  participant OSRM as OSRM API

  User ->> APIGateway: Preview Trip Route
  APIGateway ->> TripService: gRPC: PreviewTrip
  TripService ->> OSRM: HTTP: Get & Calculate Route in real world map
  OSRM ->> TripService: HTTP: Route coordinates
  TripService ->> APIGateway: HTTP: Trip route info
  APIGateway ->> User: Display Trip Preview UI

  User ->> APIGateway: Create Trip Request
  APIGateway ->> TripService: gRPC: CreateTrip
  Note over TripService, DriverService: Trip Exchange
  TripService -->>+ DriverService: trip.event.created
  Note right of TripService: Event: New trip needs a driver
  DriverService ->> Driver: driver.cmd.trip_request
  Note right of DriverService: Command: New trip available
  Driver ->> APIGateway: WebSocket: driver.cmd.trip_accept
  Note left of Driver: Command: Accept trip request
  APIGateway -->> TripService: driver.cmd.trip_accept
  Note right of APIGateway: Command forwarded to RabbitMQ (DriverTripResponseQueue)
  Note over TripService: Process driver acceptance, update trip status...
  TripService -->> PaymentService: trip.event.driver_assigned
  Note right of TripService: Event: Create payment session
  PaymentService ->> Stripe: Create Checkout Session
  Stripe -->> PaymentService: Session Created
  PaymentService -->> APIGateway: payment.event.session_created
  Note right of PaymentService: Event: Payment UI ready
  APIGateway ->> User: Show Payment UI
  Note right of APIGateway: WebSocket: Payment form
  User ->> Stripe: Complete Payment
  Stripe ->> APIGateway: Webhook: Payment Success
  APIGateway -->>+ TripService: payment.event.success
  Note right of PaymentService: Event: Payment completed


  Note right of TripService: Trip considered done


```

## ‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### –î–ª—è –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤

- üó∫Ô∏è –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞ —Å –≤—ã–±–æ—Ä–æ–º –º–∞—Ä—à—Ä—É—Ç–∞
- üí∞ –†–∞—Å—á–µ—Ç —Ç–∞—Ä–∏—Ñ–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π
- üöó –í—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª—è (–°–µ–¥–∞–Ω, –í–Ω–µ–¥–æ—Ä–æ–∂–Ω–∏–∫, –ú–∏–Ω–∏–≤—ç–Ω, –ü—Ä–µ–º–∏—É–º)
- üë®‚Äçüíº –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–æ–¥–∏—Ç–µ–ª–µ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- üí≥ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Stripe –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π
- üìç WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### –î–ª—è –≤–æ–¥–∏—Ç–µ–ª–µ–π

- üìç –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è
- üéØ –í—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª—è –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏
- üì¨ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –∑–∞–∫–∞–∑–∞—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –ü—Ä–∏–Ω—è—Ç–∏–µ/–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤
- üë§ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –≤–æ–¥–∏—Ç–µ–ª—è –Ω–∞ –∫–∞—Ä—Ç–µ –ø–∞—Å—Å–∞–∂–∏—Ä–∞

### –û–±—â–∏–µ

- üîê –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π (Stripe webhooks)
- üìä –†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∞–Ω–∏–µ (Jaeger)
- üîÑ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —á–µ—Ä–µ–∑ RabbitMQ
- üöÄ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–∞—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- üê≥ Docker & Kubernetes –¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Go** 1.24.6+
- **Node.js** 20+
- **Docker & Docker Compose**
- **Kubernetes** (Minikube, Docker Desktop –∏–ª–∏ –æ–±–ª–∞–∫–æ)
- **Tilt** –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å Tilt

–°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å—ë —Å—Ä–∞–∑—É:

```bash
# –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/n-korel/nexus-drive-go.git
cd nexus-drive-go

# –°–æ–∑–¥–∞—ë–º .env —Ñ–∞–π–ª
cp .env.example .env
# –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (API –∫–ª—é—á–∏ Stripe, MongoDB URI, etc.)

# –ó–∞–ø—É—Å–∫–∞–µ–º –≤—Å—ë —á–µ—Ä–µ–∑ Tilt
tilt up
```

Tilt –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

- ‚úÖ –°–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
- ‚úÖ –î–µ–ø–ª–æ–∏—Ç –≤ –ª–æ–∫–∞–ª—å–Ω—ã–π Kubernetes
- ‚úÖ –í–∫–ª—é—á–∞–µ—Ç –≥–æ—Ä—è—á—É—é –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–¥–∞
- ‚úÖ –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –¥–∞—à–±–æ—Ä–¥ —Å –ª–æ–≥–∞–º–∏

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É https://nexus-drive-go.vercel.app/

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
nexus-drive-go/
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ api-gateway/              # HTTP/WebSocket —à–ª—é–∑
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.go
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ http.go               # HTTP –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ws.go                 # WebSocket –ª–æ–≥–∏–∫–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ grpc_clients/         # gRPC –∫–ª–∏–µ–Ω—Ç—ã –∫ –¥—Ä—É–≥–∏–º —Å–µ—Ä–≤–∏—Å–∞–º
‚îÇ   ‚îú‚îÄ‚îÄ trip-service/             # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–µ–∑–¥–∫–∞–º–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cmd/main.go
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ domain/           # –ë–∏–∑–Ω–µ—Å –ª–æ–≥–∏–∫–∞
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ service/          # –°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ infrastructure/   # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pkg/types/            # –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ driver-service/           # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–æ–¥–∏—Ç–µ–ª—è–º–∏
‚îÇ   ‚îî‚îÄ‚îÄ payment-service/          # –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π (Stripe)
‚îÇ
‚îú‚îÄ‚îÄ web/                          # Next.js —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app/                  # Next.js —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ layout
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/           # React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DriverMap.tsx     # –ö–∞—Ä—Ç–∞ –¥–ª—è –≤–æ–¥–∏—Ç–µ–ª—è
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RiderMap.tsx      # –ö–∞—Ä—Ç–∞ –¥–ª—è –ø–∞—Å—Å–∞–∂–∏—Ä–∞
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ui/               # shadcn/ui –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/                # Custom React hooks
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useDriverStreamConnection.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useRiderStreamConnection.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ types.ts              # TypeScript —Ç–∏–ø—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ contracts.ts          # API –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils/                # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ public/                   # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îÇ
‚îú‚îÄ‚îÄ shared/                       # –û–±—â–∏–π –∫–æ–¥ –¥–ª—è Go —Å–µ—Ä–≤–∏—Å–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ contracts/                # –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ db/                       # MongoDB —É—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ env/                      # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ messaging/                # RabbitMQ wrapper
‚îÇ   ‚îú‚îÄ‚îÄ proto/                    # Protocol Buffer –∫–æ–¥—ã
‚îÇ   ‚îú‚îÄ‚îÄ retry/                    # –õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–ø–æ–≤—Ç–æ—Ä–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ tracing/                  # OpenTelemetry –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ types/                    # –û–±—â–∏–µ —Ç–∏–ø—ã
‚îÇ
‚îú‚îÄ‚îÄ proto/                        # Protocol Buffer –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ driver.proto
‚îÇ   ‚îî‚îÄ‚îÄ trip.proto
‚îÇ
‚îú‚îÄ‚îÄ deployment/
‚îÇ   ‚îî‚îÄ‚îÄ development/
‚îÇ       ‚îú‚îÄ‚îÄ docker/               # Dockerfiles
‚îÇ       ‚îî‚îÄ‚îÄ k8s/                  # Kubernetes –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã
‚îÇ
‚îú‚îÄ‚îÄ Tiltfile                      # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Tilt
‚îú‚îÄ‚îÄ Makefile                      # Build –∫–æ–º–∞–Ω–¥—ã
‚îî‚îÄ‚îÄ go.mod                        # Go –º–æ–¥—É–ª—å
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- üîí Stripe webhook signature verification
- üîê gRPC communication –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏ (–±–µ–∑ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –≤ dev, –¥–æ–±–∞–≤–∏—Ç—å mTLS –¥–ª—è prod)
- üõ°Ô∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- üìã Graceful shutdown —Å context cancellation
- üîÑ Retry logic —Å exponential backoff
- üì™ Dead Letter Queue –¥–ª—è –Ω–µ—É–¥–∞—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

## üì¶ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### Go

- `google.golang.org/grpc` - gRPC —Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- `go.mongodb.org/mongo-driver` - MongoDB –¥—Ä–∞–π–≤–µ—Ä
- `github.com/rabbitmq/amqp091-go` - RabbitMQ –∫–ª–∏–µ–Ω—Ç
- `github.com/stripe/stripe-go` - Stripe API
- `go.opentelemetry.io/*` - OpenTelemetry —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∞–Ω–∏–µ

### Node.js / Frontend

- `next` - React —Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- `react-leaflet` - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Leaflet —Å React
- `@stripe/stripe-js` - Stripe –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- `tailwindcss` - CSS —Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- `shadcn/ui` - UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- `lucide-react` - –ò–∫–æ–Ω–∫–∏

## üîå API –∏ WebSocket

### HTTP REST Endpoints (API Gateway)

#### –ü–æ–µ–∑–¥–∫–∏

- `POST /trip/preview` - –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –º–∞—Ä—à—Ä—É—Ç–∞ –∏ —Ç–∞—Ä–∏—Ñ—ã

  ```json
  {
    "userID": "user-123",
    "pickup": { "latitude": 59.92, "longitude": 30.31 },
    "destination": { "latitude": 59.93, "longitude": 30.32 }
  }
  ```

- `POST /trip/start` - –°–æ–∑–¥–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–µ–∑–¥–∫—É
  ```json
  {
    "rideFareID": "fare-id",
    "userID": "user-123"
  }
  ```

#### Webhooks

- `POST /webhook/stripe` - Stripe webhook –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π

### WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

#### –í–æ–¥–∏—Ç–µ–ª–∏

```
WS /ws/drivers?userID={userID}&packageSlug={sedan|suv|van|luxury}
```

**–°–æ–±—ã—Ç–∏—è –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:**

- `driver.cmd.register` - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- `driver.cmd.trip_request` - –ù–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–µ–∑–¥–∫—É
- `payment.event.session_created` - –û–ø–ª–∞—Ç–∞ –≥–æ—Ç–æ–≤–∞

**–°–æ–±—ã—Ç–∏—è –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞:**

- `driver.cmd.trip_accept` - –ü—Ä–∏–Ω—è—Ç—å –ø–æ–µ–∑–¥–∫—É
- `driver.cmd.trip_decline` - –û—Ç–∫–ª–æ–Ω–∏—Ç—å –ø–æ–µ–∑–¥–∫—É
- `driver.cmd.location` - –û–±–Ω–æ–≤–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ

#### –ü–∞—Å—Å–∞–∂–∏—Ä—ã

```
WS /ws/riders?userID={userID}
```

**–°–æ–±—ã—Ç–∏—è –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:**

- `driver.cmd.location` - –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤–æ–¥–∏—Ç–µ–ª–µ–π
- `trip.event.created` - –ü–æ–µ–∑–¥–∫–∞ —Å–æ–∑–¥–∞–Ω–∞
- `trip.event.driver_assigned` - –í–æ–¥–∏—Ç–µ–ª—å –Ω–∞–∑–Ω–∞—á–µ–Ω
- `trip.event.no_drivers_found` - –í–æ–¥–∏—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
- `payment.event.session_created` - –¢—Ä–µ–±—É–µ—Ç—Å—è –æ–ø–ª–∞—Ç–∞

## üì° –°–æ–±—ã—Ç–∏–π–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ (RabbitMQ)

### –°–æ–±—ã—Ç–∏—è –ø–æ–µ–∑–¥–æ–∫

- `trip.event.created` - –ü–æ–µ–∑–¥–∫–∞ —Å–æ–∑–¥–∞–Ω–∞, –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ø–æ–∏—Å–∫ –≤–æ–¥–∏—Ç–µ–ª–µ–π
- `trip.event.driver_assigned` - –í–æ–¥–∏—Ç–µ–ª—å –Ω–∞–∑–Ω–∞—á–µ–Ω –ø–∞—Å—Å–∞–∂–∏—Ä—É
- `trip.event.no_drivers_found` - –ù–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö –≤–æ–¥–∏—Ç–µ–ª–µ–π
- `trip.event.driver_not_interested` - –í–æ–¥–∏—Ç–µ–ª—å –æ—Ç–∫–ª–æ–Ω–∏–ª –ø–æ–µ–∑–¥–∫—É

### –ö–æ–º–∞–Ω–¥—ã –≤–æ–¥–∏—Ç–µ–ª–µ–π

- `driver.cmd.trip_request` - –ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤–æ–¥–∏—Ç–µ–ª—é
- `driver.cmd.trip_accept` - –í–æ–¥–∏—Ç–µ–ª—å –ø—Ä–∏–Ω—è–ª –ø–æ–µ–∑–¥–∫—É
- `driver.cmd.trip_decline` - –í–æ–¥–∏—Ç–µ–ª—å –æ—Ç–∫–ª–æ–Ω–∏–ª –ø–æ–µ–∑–¥–∫—É

### –°–æ–±—ã—Ç–∏—è –ø–ª–∞—Ç–µ–∂–µ–π

- `payment.cmd.create_session` - –°–æ–∑–¥–∞—Ç—å —Å–µ—Å—Å–∏—é Stripe
- `payment.event.session_created` - –°–µ—Å—Å–∏—è —Å–æ–∑–¥–∞–Ω–∞
- `payment.event.success` - –ü–ª–∞—Ç—ë–∂ —É—Å–ø–µ—à–µ–Ω
